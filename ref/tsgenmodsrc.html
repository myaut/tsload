<html>
<head>
	<meta http-equiv="Content-Type" content="text/html">
	<meta name="generator" content="TSDoc 0.2">
	
	<title>TSLoad reference</title>
	
	<link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css" />
	<link href="../bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" />
</head>
<body>

<!-- HEADER -->

<div class="navbar">
    <div class="navbar-inner">
	    <div class="container">
			<a class="brand" href="../index.html">tsload 0.2.a1 documentation</a><ul class="nav pull-left">
<li><a href="tsfutil.html"><strong>Prev</strong>(tsfutil)</a></li>
</ul>
<ul class="nav pull-right">
<li><a href="experiment_json.html"><strong>Next</strong>(experiment.json)</a></li>
</ul>
		</div>
    </div>
</div>

<div class="container max-height no-overflow">
	<div id="content" nevow:render="content">
		<p>
<h2>tsgenmodsrc</h2></p>
<p>
tsgenmodsrc - Generate source code for TSLoad module<br /></p>
<p>
<pre>
$ tsgenmodsrc [global options] subcommand path/to/modinfo.json
</pre>
</p>
<p>
tsgenmodsrc generates environment using <a href="modinfo_json.html">modinfo.json</a> configuration file, called <em>modvars</em>. Then it loads templates from development directory of TSLoad and preprocesses them.<br /></p>
<p>
A chosen set of generated files depends on <strong>-b</strong> and <strong>-t</strong> global options:<br />     <ul>
        <li>
<strong>-b</strong> with an option argument:<br />   </li>
        <ul>
            <li>
<code>scons</code> - Generate build files for SCons (default)<br />   </li>
            <li>
<code>make</code> - Generate build files for GNU Make<br /> </li>
</ul>
        <li>
<strong>-t</strong> (only valid with -b scons)<br />   </li>
        <ul>
            <li>
<code>int</code> - Generate SConscript to be used inside TSLoad<br />   </li>
            <li>
<code>ext</code> - Generate SConstruct to build module outside (default)<br /></li>
</ul>
</ul>
</p>
<p>
Paths to TSLoad installation directories that is used by <em>tsgenmodsrc</em> to locate templates and added to build files are usually deduced from tsgenmodsrc location, but if they didn't, they could be specified from environment variables:<br />     <ul>
        <li>
<code>TSLOADPATH</code> - root directory where TSLoad is installed<br /> </li>
        <li>
<code>TS_INSTALL_SHARE</code> - path to share directory relative to TSLOADPATH<br /> </li>
        <li>
<code>TS_INSTALL_INCLUDE</code> - path to include directory relative to TSLOADPATH<br /> </li>
        <li>
<code>TS_INSTALL_LIB</code> - path where libraries are installed relative to TSLOADPATH<br /> </li>
        <li>
<code>TS_INSTALL_MOD_LOAD</code> - path where modules should be installed relative to TSLOADPATH<br /></li>
</ul>
</p>
<p>
<h3>Variables</h3></p>
<p>
To see what variables are generated by <em>tsgenmodsrc</em>, call it with <strong>vars</strong> subcommand:<br /></p>
<p>
<pre>
$ tsgenmodsrc [global options] vars path/to/modinfo.json
</pre>
</p>
<p>
These options may be redefined by <code>vars</code> object inside modinfo.json config. However some of them has <code>[generated]</code> flag that means that they are not settable from config, and generated from other options - for example structure fields.<br /></p>
<p>
    <ul>
        <li>
<code>MODNAME</code> - name of module, taken from configuration file <br />  </li>
        <li>
<code>MODTYPE</code> - type of module, taken from configuration file<br />  </li>
        <li>
<code>SOURCE_FILENAME</code>, <code>HEADER_FILENAME</code> - name of source files<br />  </li>
        <li>
<code>MAKEFILE_FILENAME</code>, <code>SCONSTRUCT_FILENAME</code>, <code>SCONSCRIPT_FILENAME</code> - names of build files. It is advised not to change these variables.<br />  </li>
        <li>
<code>MODULE_FILENAME</code>, <code>OBJECT_FILENAME</code> - build file names<br />  </li>
        <li>
<code>HEADER_DEF</code> - macro defined inside header in #ifdef / #define construct<br />  </li>
        <li>
<code>CCFLAGS</code>, <code>LIBS</code>, <code>SHCCFLAGS</code>, <code>SHLINKFLAGS</code> - compiler and linker flags (taken from build environment of TSLoad)<br />  </li>
        <li>
<code>SHOBJSUFFIX</code>, <code>SSHLIBSUFFIX</code> - filename suffixes (extensions) for modules (taken from build environment of TSLoad)<br />  </li>
        <li>
<code>MODINFODIR</code> - directory where <em>modinfo.json</em> is located<br />  </li>
        <li>
<code>TS*</code> - same as environment variables (see above)<br /></li>
</ul>
</p>
<p>
Workload type variables are contained in namespaces, so different wltype would get different values:<br />      <ul>
        <li>
<code>WLT_NAME</code> - name of workload type, usually matches with name of the module<br />  </li>
        <li>
<code>WLT_ABBR</code> - abbreviation of workload type which is needed to generate variable names. Contains first letter of WLT_NAME followed by letters after underscores. I.e. test_module -&gt; tm.<br />  </li>
        <li>
<code>WL_PARAM_STRUCT</code>, <code>WL_PARAM_FIELDS</code>, <code>WL_PARAM_VARNAME</code> - Workload parameters. STRUCT contains name of data structure keeping them, FIELDS is a generator for C structure members, and VARNAME is a name of variable that would be created in functions implementing workload type. <br />  </li>
        <li>
<code>WL_DATA_STRUCT</code>, <code>WL_DATA_VARNAME</code> - Same as WL_PARAM_* but for internal workload data.<br />  </li>
        <li>
<code>RQ_PARAM_STRUCT</code>, <code>RQ_PARAM_FIELDS</code>, <code>RQ_PARAM_VARNAME</code> - Same as WL_PARAM_* but for per-request params.<br />  </li>
        <li>
<code>WLT_VARNAME</code> - name of workload type descriptor variable<br />  </li>
        <li>
<code>WLT_CLASS</code> - generated from config - class of workload<br />  </li>
        <li>
<code>WL_PARAMS_VARNAME</code> - name of workload parameter descriptor array<br />  </li>
        <li>
<code>WL_PARAMS_ARRAY</code> - generated from config - workload parameter descriptors<br />  </li>
        <li>
<code>FUNC_CONFIG</code> - function name of workload configuration<br />  </li>
        <li>
<code>FUNC_UNCONFIG</code> - function name of workload de-configuration<br />  </li>
        <li>
<code>FUNC_RUN_REQUEST</code> - name of the function that runs request<br />  </li>
        <li>
<code>FUNC_STEP</code> - name of the function that is called at the beginning of each step<br />  </li>
</ul>
</p>
<p>
<h3>Generating sources</h3></p>
<p>
Sources are generated in two modes. In first one, <em>tsgenmodsrc</em> will write appropriate file to stdout, where template used for file is determined by provided subcommand:<br />     <ul>
        <li>
<code>header</code> or <code>hdr</code> will generate C header<br /> </li>
        <li>
<code>source</code> or <code>src</code> will generate C source<br /> </li>
        <li>
<code>makefile</code> will generate build file which is determined by <strong>-b</strong> and <strong>-t</strong> options arguments.<br /> </li>
</ul>
</p>
<p>
In second mode, which is activated by <code>generate</code> command, <em>tsgenmodsrc</em> will automatically create file hierarchy inside the same directory where <em>modinfo.json</em> configuration file is located. If directory has other files than <em>modinfo.json</em>, command will fail, so <em>tsgenmodsrc</em> wouldn't overwrite them.  <br /></p>
<p>
If sources were generated in second mode, they and object files created during build may be cleaned up with <code>clean</code> command. <em>tsgenmodsrc</em> caches creation times of files in special file <code>.ctime_cache</code>, so if you will change source, it will warn you before cleanup. <code>clean</code> subcommand will ask for confirmation before cleanup that should be answered <code>y</code> (yes) or <code>f</code> (force), if warnings were found.<br /></p>
<p>
<h3>Preprocessor</h3></p>
<p>
To generate sources and build files, <em>tsgenmodsrc</em> uses preprocessor. This preprocessor uses at symbol <code>@</code> as command character. Note that it doesn't support its escaping (but for Makefiles where <code>$@</code> has special meaning), it will ignore that character. <br /></p>
<p>
Preprocessor supports following features:<br />    <ul>
        <li>
 Substitution: variable surrounded by ats replaced with its value or generated text. I.e. <code>@WLT_NAME@</code></li>
        <li>
 Directive <code>@ifdef</code> followed by variable name. Conditional generation - adds following lines to resulting file only if variable is defined. May be followed by <code>@else</code> block, ended with <code>@endif</code> directive. <br /></li>
        <li>
 Directive <code>@define</code> followed by variable name. Creates new macro, that supports substitution like variables. The following text may contain macro-substitutions or conditional directives. Ended with <code>@enddef</code> directive. These directives couldn't be nested.<br /></li>
</ul>
</p>
<p>
Complete BNF for preprocessor is:<br /></p>
<p>
<pre>
&lt;opt-whitespace&gt;     ::= &lt;whitespace&gt; | &lt;whitespace&gt; &lt;opt-whitespace&gt; | ""

&lt;var-char&gt;           ::= &lt;alpha&gt; | "_"
&lt;var-name&gt;           ::= &lt;var-char&gt; | &lt;var-char&gt; &lt;var-name&gt;

&lt;dir-param-var&gt;      ::= &lt;opt-whitespace&gt; &lt;var-name&gt; &lt;opt-whitespace&gt; &lt;EOL&gt;
&lt;dir-param-nothing&gt;  ::= &lt;opt-whitespace&gt; &lt;EOL&gt;

&lt;subst-expr&gt;         ::= "@" &lt;var-name&gt; "@"

&lt;block&gt;              ::= &lt;text&gt; | &lt;ifdef-block&gt; | &lt;subst-expr&gt;
&lt;blocks&gt;             ::= &lt;block&gt; | &lt;block&gt; &lt;blocks&gt;

&lt;else-block&gt;         ::= "@else" &lt;dir-param-nothing&gt;
                         &lt;blocks&gt; &lt;EOL&gt;
&lt;opt-else-block&gt;     ::= &lt;else-block&gt; | ""
&lt;ifdef-block&gt;        ::= "@ifdef" &lt;dir-param-var&gt;
                         &lt;blocks&gt; &lt;EOL&gt;
                         &lt;opt-else-block&gt;
                        "@endif" &lt;dir-param-nothing&gt;

&lt;define-block&gt;       ::= "@define" &lt;dir-param-var&gt;
                         &lt;blocks&gt;
                        "@enddef"
&lt;foreach-block&gt;     ::= "@foreach" &lt;dir-param-var&gt;
                        &lt;blocks&gt;
                        "@endfor"                        
</pre>
</p>

	</div>
</div>

<!-- TAIL -->

</body>
</html>